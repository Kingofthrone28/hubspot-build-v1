<!--
  templateType: blog_listing
  isAvailableForNewContent: true
  label: Blog - Landing
  screenshotPath: ../../images/blog-landing-page-editor-preview.jpg
-->
{# Templates #}
{% extends '../layouts/base.html' %}
{% from "../../macros/get-app-config.html" import get_app_config %}
{{ require_js(get_asset_url('../../js/blog-nav.js')) }}

{# Variables #}
{# Prefix bl (blog landing) added to prevent over-writing variables in children modules #}
{% set bl_app_config = {} %}
{{ get_app_config(bl_app_config) }}
{% set bl_dict = {
    "tag_menu_id": bl_app_config.blog_tag_menu_id,
    "category_tags": {},
  }
%}
{% do bl_dict.put("tag_menu", menu(bl_dict.tag_menu_id)) %}
{% do bl_dict.put("active_tags", blog_tags("default")) %}
{% for category in bl_dict.tag_menu.children if bl_dict.tag_menu.children %}
  {% do bl_dict.category_tags.put(category.label, category.children) if category.children %}
{% endfor %}

{# html #}
{% block body %}
  <main class="offset-header">
    {% module "blog-category-search"
      path="../../modules/Blog - Search Term",
      label="Blog - Search Term",
      tag_menu="{{ bl_dict.tag_menu_id }}",
      blog_search_heading="Articles & Ideas",
      page_level="level-1"
    %}
    {# Featured story grid #}
    {% module "blog-category-featured-story-grid"
      path="../../modules/Featured Story Grid",
      label="Blog - Featured Story Grid",
      tag_menu="{{ bl_dict.tag_menu_id }}"
    %}
    {# Latest blog posts #}
      {% module "blog-latest-posts"
      path="../../modules/Blog - Latest Posts",
      label="Blog - Latest Posts",
      menu="{{ bl_dict.tag_menu_id }}"
      %}
    {# DND Section #}
    {% dnd_area 'dnd_area' label="Main DND section" %}
      {% dnd_section full_width=true %}
        {% dnd_column offset=0, width=12 %}
          {% dnd_row %}{% end_dnd_row %}
        {% end_dnd_column %}
      {% end_dnd_section %}
    {% end_dnd_area %}
    {# Teasers #}
    {% for category_label, tag_list in bl_dict.category_tags.items() %}
      {# Slug-ify tag labels for blog_recent_tag_posts call #}
      {%- set tag_slug_list = tag_list
          |map("label")
          |map("lower")
          |map("regex_replace", " \\+ ", "-")
          |map("regex_replace", " ", "-")
      -%}
      {% module "blog-category-teasers"
        path="../../modules/Blog Teasers",
        label="Blog - Teasers",
        unique_in_loop=True,
        tag_menu="{{ bl_dict.tag_menu_id }}",
        layout="two_column",
        listing_page_tag_slug_list="{{ tag_slug_list }}",
        listing_page_category="{{ category_label }}"
      %}
    {% endfor %}
  </main>
{% endblock body %}
