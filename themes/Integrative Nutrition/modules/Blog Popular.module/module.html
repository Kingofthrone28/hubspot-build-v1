{% macro render_blog_posts(posts) %}
  <div class="row">
    {% for post in posts %}
      {% set author = post.blog_author.name %}
      {% set initial_post_words = post.post_body|striptags|wordcount %}
      {% set read_time_post_words = (initial_post_words / 200)|round(0, 'ceil') %}
      {% set is_read_time_words = read_time_post_words <=1 ? 'read time: less than 1 min' : 'read time: {{ read_time_post_words }} mins'  %}
      <a href="{{ post.url }}" class="popular-blog__section">
        <span class="popular-blog__category">{{ post.topic_list[0].name }}</span>
        <h4 class="popular-blog__heading">{{ post.name }}</h4>
        {% if author %}
          <p class="popular-blog__byline">By {{ author }} | {{ is_read_time_words }}</p>
        {% endif %}
      </a>
    {% endfor %}
  </div>
{% endmacro %}

{% macro render_popular_blog_posts_by_tag(tag) %}
  {% set time_frame = module.time_frame %}
  {% set popular_posts = blog_popular_posts("default", 3, [tag], time_frame, "AND") %}
  {{ render_blog_posts(popular_posts) }}
{% endmacro %}

<div class="popular-blog">
  <div class="popular-blog__container">
    <h4 class="popular-blog__header">{{module.section_title}}</h4>
    <div class="popular-blog__posts">
      {{ render_popular_blog_posts_by_tag(module.pop_tag_field) }}
    </div>
  </div>
</div>